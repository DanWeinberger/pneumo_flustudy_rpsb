---
title: "analysis"
author: "Dan Weinberger"
date: '2022-08-25'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(reshape2)
library(gee)
library(mgcv)
```

```{r}
# a1 <- read_excel('./Data/CONFIDENTIAL/flu_data_stats.xlsx', sheet='flu1')
# 
# a2 <- read_excel('./Data/CONFIDENTIAL/flu_data_stats.xlsx', sheet='flu2')
# 
# b1 <- bind_rows(a1,a2)
#saveRDS(b1,'./Data/combined_data.rds')
```

```{r}
b1 <- readRDS('./Data/combined_data.rds') %>%
  mutate( agecat = as.factor(if_else(age<60, 0, 1)),
          agecat2 = as.factor(if_else(age<60, 0, if_else(age<80,1,2))),
          Year = as.factor(Year),
          id=as.factor(id),
          center=as.factor(substr(full_id,1,1)),
          piab_pos = if_else(piaB<40,1,0),
          lyta_pos = if_else(extlytA<40,1,0),
          true_pos = piab_pos*lyta_pos,
          false_pos = if_else(piab_pos==0 & lyta_pos==1,1,0 ) )

table(b1$agecat2, b1$agecat2)
```


```{r}
b1 %>%
  group_by(agecat) %>%
  summarize(prev_piab=mean(piab_pos, na.rm=T), N_pos_piab=sum(piab_pos, na.rm=T), prev_false_pos=mean(false_pos, na.rm=T)  )
  
```





